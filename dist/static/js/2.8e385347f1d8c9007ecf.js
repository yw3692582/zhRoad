webpackJsonp([2],{"9bBU":function(t,e,a){a("mClu");var n=a("FeBl").Object;t.exports=function(t,e,a){return n.defineProperty(t,e,a)}},C4MV:function(t,e,a){t.exports={default:a("9bBU"),__esModule:!0}},bOdI:function(t,e,a){"use strict";e.__esModule=!0;var n,i=a("C4MV"),s=(n=i)&&n.__esModule?n:{default:n};e.default=function(t,e,a){return e in t?(0,s.default)(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}},gbLQ:function(t,e){},mClu:function(t,e,a){var n=a("kM2E");n(n.S+n.F*!a("+E39"),"Object",{defineProperty:a("evD5").f})},vnDm:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("fZjL"),i=a.n(n),s=a("bOdI"),o=a.n(s),l=a("7lgi"),r={inject:["reload"],data:function(){var t;return t={dialogEditVisible:!1,eid:"",getSearchInfo:[],searchTableInfo:"",options:[],search:"",pagesize:Object(l.a)(),currpage:1,currentPage1:null,isradio:!1,e_code:"",station_id:"",station_name:"",lon_lat:"",address:"",sub_id:[],sub_eid:"",longitude:"",latitude:"",btn:!0,btn1:!0,btn2:!0,btn7:!0,old_sta_id:"",old_sta_name:"",old_lon_lat:""},o()(t,"btn7",!0),o()(t,"new_lon_lat",[]),t},computed:{tableData:function(){var t=this.searchTableInfo;return t?(this.currpage=1,this.currentPage1=1,this.getSearchInfo.filter(function(e){return i()(e).some(function(a){return String(e[a]).toLowerCase().indexOf(t)>-1})})):this.getSearchInfo}},watch:{station_id:function(t,e){t==this.old_sta_id?this.btn1=!0:(this.station_id=t,this.btn1=!1)},station_name:function(t,e){t==this.old_sta_name?this.btn2=!0:(this.station_name=t,this.btn2=!1)},lon_lat:function(t,e){t==this.old_lon_lat?this.btn7=!0:this.btn7=!1}},methods:{setCellStyle:function(t){var e=t.row;t.column,t.rowIndex;if(6==t.columnIndex&&0===e.status)return{color:"red"}},getRowClass:function(t){t.row,t.column,t.rowIndex,t.columnIndex;return"background:#f1f3fa;color:rgba(0,0,0,85);border-color: #eeeeee;"},b:function(){for(var t=this,e=0;e<this.lon_lat.length;e++){if(","==this.lon_lat[e]){if(this.new_lon_lat=this.lon_lat.split(","),this.new_lon_lat[0]>180)return void this.$message({type:"warning",message:"经度不得超过180"});if(this.new_lon_lat[1]>90)return void this.$message({type:"warning",message:"纬度不得超过90"})}if("，"==this.lon_lat[e]){if(this.new_lon_lat=this.lon_lat.split("，"),this.new_lon_lat[0]>180)return void this.$message({type:"warning",message:"经度不得超过180"});if(this.new_lon_lat[1]>90)return void this.$message({type:"warning",message:"纬度不得超过90"})}}var a=this.$ajax.defaults.headers.common;delete a.token,delete a.username,this.$ajax.get("//restapi.amap.com/v3/geocode/regeo?key=657d0c0ea15e983c2b8f48fb44059ef5&location="+this.new_lon_lat[0]+","+this.new_lon_lat[1]).then(function(e){t.address=e.data.regeocode.formatted_address}).catch(function(e){t.$message({type:"error",message:"获取地址失败，请刷新页面"})})},register:function(){this.$router.push("/createEq")},handleEdit:function(t,e){this.dialogEditVisible=!0,null==e.station_id||""==e.station_id?this.old_sta_id=e.station_id:this.old_sta_id=e.station_id.concat(),this.eid=e.eid,this.e_code=e.e_code,this.station_id=e.station_id,this.station_name=e.station_name,this.old_sta_name=e.station_name.concat(),this.lon_lat=e.longitude+","+e.latitude,this.lon_lat=e.longitude+"，"+e.latitude,this.old_lon_lat=this.lon_lat.concat(),this.longitude=e.longitude,this.latitude=e.latitude,this.address=e.address},cancel:function(){this.station_id="",this.station_name="",this.lon_lat="",this.address="",this.dialogEditVisible=!1},editEqu:function(){var t=this;if(6==this.station_id.length){this.station_id==this.old_sta_id&&(this.station_id=""),this.station_name==this.old_sta_name&&(this.station_name=""),null==this.longitude&&null==this.latitude&&null==this.address&&(this.longitude="",this.latitude="",this.address="");for(var e=0;e<this.lon_lat.length;e++)","==this.lon_lat[e]&&(this.new_lon_lat=this.lon_lat.split(",")),"，"==this.lon_lat[e]&&(this.new_lon_lat=this.lon_lat.split("，"));this.$ajax.defaults.headers.common.token=localStorage.getItem("token"),this.$ajax.post("/manage_equipments",{eid:this.eid,e_code:"",station_name:encodeURI(this.station_name),longitude:this.new_lon_lat[0],latitude:this.new_lon_lat[1],creator:"",message_push:this.isradio.toString(),address:encodeURI(this.address),station_id:this.station_id,sub_device:{id:[],new_sub_device:[]},extend_data:{}}).then(function(e){switch(e.data.code){case-1:localStorage.clear(),top.location.href="http://zhgl.hngl.cn:8080/auth-server/login";break;case 0:t.$message({type:"error",message:"修改失败"});break;case 1:t.$message({type:"success",message:"修改成功"});break;case 2:t.$message({type:"warning",message:"设备号重复"});break;case 3:t.$message({type:"warning",message:"设备名重复"})}t.reload()}).catch(function(e){t.$message({type:"error",message:"编辑信息失败"}),t.reload()}),this.dialogEditVisible=!1}else this.$message({type:"warning",message:"设备编号必须为6位"})},handleDelete:function(t,e){var a=this;this.$confirm("此操作将永久删除该设备信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$ajax.defaults.headers.common.token=localStorage.getItem("token"),a.$ajax.post("/delete_equipments",{eid:e.eid}).then(function(t){if(1==t.data.code&&a.$message({type:"success",message:"删除信息成功"}),-1==t.data.code)return alert("登陆已失效，请重新登陆！"),localStorage.clear(),void(top.location.href="http://zhgl.hngl.cn:8080/auth-server/login");a.reload()}).catch(function(t){a.$message({type:"error",message:"删除用户信息失败"}),a.reload()})}).catch(function(){a.$message({type:"info",message:"已取消删除"})})},handleCurrentChange:function(t){this.currpage=t},formatterTime:function(t,e){var a=t[e.property];return void 0==a?"":moment(1e3*a).format("YYYY-MM-DD HH:mm:ss")},equ:function(){var t=this;this.$ajax.defaults.headers.common.token=localStorage.getItem("token"),this.$ajax.post("/equip_all_info").then(function(e){if(-1==e.data.code)return alert("登陆已失效，请重新登陆！"),localStorage.clear(),void(top.location.href="http://zhgl.hngl.cn:8080/auth-server/login");var a=e.data.records;t.getSearchInfo=a}).catch(function(e){t.$message({type:"error",message:"获取数据失败"})})},on_off_line:function(t,e){switch(t.status){case 0:return"离线";default:return"在线"}}},mounted:function(){this.equ()}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-button",{staticStyle:{display:"flex","font-size":"16px","margin-bottom":"10px"},attrs:{type:"primary"},on:{click:function(e){return t.$router.push("/createEqu")}}},[t._v("新建设备")]),t._v(" "),a("div",{staticClass:"table-wrapper"},[a("el-table",{staticStyle:{width:"100%","font-size":"16px"},attrs:{border:"",data:t.tableData.slice((t.currpage-1)*t.pagesize,t.currpage*t.pagesize),"row-style":t.getRowClass,"header-row-style":t.getRowClass,"header-cell-style":t.getRowClass,"cell-style":t.setCellStyle}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"经度:"}},[a("span",[t._v(t._s(e.row.longitude))])]),t._v(" "),a("el-form-item",{attrs:{label:"纬度:"}},[a("span",[t._v(t._s(e.row.latitude))])])],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"设备名称",prop:"station_name",align:"center","min-width":"152px"}}),t._v(" "),a("el-table-column",{attrs:{label:"设备号",prop:"eid",align:"center","min-width":"184px"}}),t._v(" "),a("el-table-column",{attrs:{label:"设备状态",prop:"status",align:"center","min-width":"120px",formatter:t.on_off_line}}),t._v(" "),a("el-table-column",{attrs:{align:"center","min-width":"155px"},scopedSlots:t._u([{key:"header",fn:function(e){return[a("el-input",{attrs:{size:"mini","prefix-icon":"el-icon-search",placeholder:"请输入内容搜索"},model:{value:t.searchTableInfo,callback:function(e){t.searchTableInfo=e},expression:"searchTableInfo"}})]}},{key:"default",fn:function(e){return[a("el-link",{attrs:{type:"danger"},on:{click:function(a){return t.handleDelete(e.$index,e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),a("el-pagination",{attrs:{background:"","current-page":t.currentPage1,"page-size":t.pagesize,layout:"total, prev, pager, next, jumper",total:t.tableData.length},on:{"update:currentPage":function(e){t.currentPage1=e},"update:current-page":function(e){t.currentPage1=e},"current-change":t.handleCurrentChange}})],1),t._v(" "),a("div",{staticClass:"edit_dia"},[a("el-dialog",{attrs:{"close-on-click-modal":!1,title:"编辑设备",visible:t.dialogEditVisible},on:{"update:visible":function(e){t.dialogEditVisible=e},close:t.cancel}},[a("el-form",{attrs:{"status-icon":""},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{staticStyle:{"padding-bottom":"10px"},attrs:{label:"台站编号"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入设备编号"},model:{value:t.station_id,callback:function(e){t.station_id="string"==typeof e?e.trim():e},expression:"station_id"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"设备名称"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入设备名称"},model:{value:t.station_name,callback:function(e){t.station_name="string"==typeof e?e.trim():e},expression:"station_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"设备经纬度,例:113.790921,34.748171"}},[a("el-input",{attrs:{placeholder:"请输入经纬度"},on:{blur:function(e){return e.preventDefault(),t.b()}},model:{value:t.lon_lat,callback:function(e){t.lon_lat=e},expression:"lon_lat"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"地址"}},[a("el-input",{attrs:{disabled:"",placeholder:"根据经纬度自动填充"},model:{value:t.address,callback:function(e){t.address=e},expression:"address"}})],1)],1),t._v(" "),a("div",[a("el-button",{on:{click:t.cancel}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:t.btn1&&t.btn2&&t.btn7?t.btn:0==t.btn,"native-type":"submit"},on:{click:t.editEqu}},[t._v("修改")])],1)],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(r,d,!1,function(t){a("gbLQ")},"data-v-d846871a",null);e.default=c.exports}});